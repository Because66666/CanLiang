(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[439],{318:(e,r,s)=>{Promise.resolve().then(s.bind(s,8563))},646:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});let a=(0,s(9946).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},1284:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});let a=(0,s(9946).A)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},8145:(e,r,s)=>{"use strict";s.d(r,{E:()=>c});var a=s(5155);s(2115);var l=s(2085),t=s(3999);let n=(0,l.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:r,variant:s,...l}=e;return(0,a.jsx)("div",{className:(0,t.cn)(n({variant:s}),r),...l})}},8563:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>C});var a=s(5155),l=s(2115),t=s(8482),n=s(9852),c=s(646),i=s(4861),o=s(9946);let d=(0,o.A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var m=s(1284);let x=(0,o.A)("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);var h=s(7924),g=s(5784),u=s(9663),p=s(7168),j=s(8145),f=s(5466),y=s(9882),v=s(1886);let N=e=>{switch(e.toLowerCase()){case"success":return(0,a.jsx)(c.A,{className:"w-4 h-4 text-green-500"});case"error":return(0,a.jsx)(i.A,{className:"w-4 h-4 text-red-500"});case"warning":return(0,a.jsx)(d,{className:"w-4 h-4 text-yellow-500"});default:return(0,a.jsx)(m.A,{className:"w-4 h-4 text-blue-500"})}},b=e=>{switch(e.toLowerCase()){case"success":return"bg-green-100 text-green-800 border-green-200";case"error":return"bg-red-100 text-red-800 border-red-200";case"warning":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-blue-100 text-blue-800 border-blue-200"}},w=e=>{if(!e)return"未知时间";try{let r=new Date(e),s=r.getFullYear(),a=String(r.getMonth()+1).padStart(2,"0"),l=String(r.getDate()).padStart(2,"0"),t=String(r.getHours()).padStart(2,"0"),n=String(r.getMinutes()).padStart(2,"0"),c=String(r.getSeconds()).padStart(2,"0");return"".concat(s,"-").concat(a,"-").concat(l," ").concat(t,":").concat(n,":").concat(c)}catch(r){return e}};function C(){let[e,r]=(0,l.useState)({data:[],loading:!0,error:null,searchTerm:"",selectedEvent:"all",limit:100}),[s,c]=(0,l.useState)({programs:["桌面"],selectedProgram:"",isStreaming:!1,streamUrl:"",loading:!1,error:null}),i=async()=>{try{c(e=>({...e,loading:!0,error:null}));let e=await v.K.fetchProgramList();if(e.success&&e.data&&e.data.length>0){let r=e.data[0];c(s=>({...s,programs:e.data,selectedProgram:r,loading:!1})),await o(r)}else c(r=>({...r,programs:e.data||[],error:e.message||"获取程序列表失败",loading:!1}))}catch(e){c(r=>({...r,error:e instanceof Error?e.message:"网络错误",loading:!1}))}},o=async e=>{try{c(e=>({...e,error:null}));let r=await v.K.getVideoStreamUrl({app:e});r?c(e=>({...e,isStreaming:!0,streamUrl:r})):c(e=>({...e,error:"启动推流失败"}))}catch(e){c(r=>({...r,error:e instanceof Error?e.message:"网络错误"}))}},d=async()=>{try{r(e=>({...e,loading:!0,error:null}));let s=await v.K.fetchWebhookData(e.limit);s.success&&s.data?r(e=>({...e,data:s.data,loading:!1})):r(e=>({...e,error:s.message||"获取数据失败",loading:!1}))}catch(e){r(r=>({...r,error:e instanceof Error?e.message:"网络错误",loading:!1}))}},C=async()=>{try{r(e=>({...e,error:null}));let s=await v.K.fetchWebhookData(e.limit);s.success&&s.data?r(e=>({...e,data:s.data})):r(e=>({...e,error:s.message||"获取数据失败"}))}catch(e){r(r=>({...r,error:e instanceof Error?e.message:"网络错误"}))}};(0,l.useEffect)(()=>{d(),i()},[e.limit]),(0,l.useEffect)(()=>{let e=setInterval(()=>{C()},3e3);return()=>clearInterval(e)},[e.limit]);let k=e.data.filter(r=>{let s=!e.searchTerm||r.event.toLowerCase().includes(e.searchTerm.toLowerCase())||r.message&&r.message.toLowerCase().includes(e.searchTerm.toLowerCase())||r.result&&r.result.toLowerCase().includes(e.searchTerm.toLowerCase()),a="all"===e.selectedEvent||r.event.toLowerCase()===e.selectedEvent.toLowerCase();return s&&a}),S=Array.from(new Set(e.data.map(e=>e.event)));return(0,a.jsx)("main",{className:"min-h-screen bg-background",children:(0,a.jsxs)("div",{className:"container mx-auto py-8 px-4",children:[(0,a.jsx)("div",{className:"mb-8 text-3xl font-bold text-center flex items-center justify-center gap-3",style:{color:y.Tj.secondary},children:"BetterGI面板"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-3",children:(0,a.jsx)("div",{className:"grid grid-rows-2 gap-6 h-full",children:(0,a.jsx)(t.Zp,{className:"h-full",children:(0,a.jsxs)(t.Wu,{className:"p-6 h-full",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[(0,a.jsx)(x,{className:"w-5 h-5"}),"实时屏看"]})}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"状态:"}),(0,a.jsx)(j.E,{variant:s.isStreaming?"default":"secondary",children:s.isStreaming?"观看中":"无信号"}),s.selectedProgram&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"font-medium ml-4",children:"目标程序:"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:s.selectedProgram})]}),(0,a.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,a.jsxs)(g.l6,{value:s.selectedProgram,onValueChange:e=>{c(r=>({...r,selectedProgram:e,error:null})),e&&o(e)},children:[(0,a.jsx)(g.bq,{className:"w-[200px]",children:(0,a.jsx)(g.yv,{placeholder:"选择程序"})}),(0,a.jsx)(g.gC,{children:0===s.programs.length?(0,a.jsx)(g.eb,{value:"",disabled:!0,children:"暂无可用程序"}):s.programs.map((e,r)=>(0,a.jsx)(g.eb,{value:e,children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x,{className:"w-4 h-4"}),e]})},r))})]}),(0,a.jsx)(p.$,{onClick:i,disabled:s.loading,variant:"outline",size:"sm",children:s.loading?"加载中...":"刷新"})]}),s.loading&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"font-medium ml-4",children:"正在:"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"自动连接中..."})]})]})}),s.error&&(0,a.jsx)(f.Jr,{type:"error",message:s.error,className:"mb-4"}),(0,a.jsx)("div",{className:"flex-1 bg-black rounded-lg flex items-center justify-center min-h-[300px]",children:s.isStreaming&&s.streamUrl?(0,a.jsx)("img",{src:s.streamUrl,alt:"实时视频流",className:"w-full h-full rounded-lg object-contain",onError:e=>{console.error("视频流加载失败:",e),c(e=>({...e,error:"视频流连接失败，请检查网络连接"}))},onLoad:()=>{console.log("视频流连接成功")}}):(0,a.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,a.jsx)(x,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),s.loading?(0,a.jsx)("p",{children:"正在自动连接推流..."}):0===s.programs.length?(0,a.jsx)("p",{children:"暂无可用程序，请确保有程序正在运行"}):(0,a.jsx)("p",{children:"等待自动推流连接"})]})})]})})})}),(0,a.jsxs)("div",{className:"lg:col-span-1",children:[(0,a.jsx)(t.Zp,{className:"mb-4",children:(0,a.jsx)(t.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 w-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.A,{className:"h-4 w-4",style:{color:y.Tj.primary}}),(0,a.jsx)("span",{className:"text-sm",style:{color:y.Tj.secondary},children:"搜索事件:"})]}),(0,a.jsx)("div",{className:"relative w-full",children:(0,a.jsx)(n.p,{placeholder:"搜索事件...",value:e.searchTerm,onChange:e=>r(r=>({...r,searchTerm:e.target.value})),className:"pl-4 py-3 border-0 shadow-sm focus:ring-2 w-full",style:{borderColor:y.Tj.lightBorder,boxShadow:"0 0 0 1px ".concat(y.Tj.lightBorder)}})})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 w-full",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.A,{className:"h-4 w-4",style:{color:y.Tj.primary}}),(0,a.jsx)("span",{className:"text-sm",style:{color:y.Tj.secondary},children:"事件类型:"})]}),(0,a.jsxs)(g.l6,{value:e.selectedEvent,onValueChange:e=>r(r=>({...r,selectedEvent:e})),children:[(0,a.jsx)(g.bq,{className:"w-full border-0 shadow-sm focus:ring-2",style:{borderColor:y.Tj.lightBorder,boxShadow:"0 0 0 1px ".concat(y.Tj.lightBorder)},children:(0,a.jsx)(g.yv,{placeholder:"事件类型"})}),(0,a.jsxs)(g.gC,{children:[(0,a.jsx)(g.eb,{value:"all",children:"所有事件"}),S.map(e=>(0,a.jsx)(g.eb,{value:e.toLowerCase(),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[N(e),(0,a.jsx)("span",{className:"text-xs",children:e})]})},e))]})]})]}),(0,a.jsx)("div",{className:"flex flex-col items-center gap-2 w-full",children:(0,a.jsx)("button",{onClick:d,disabled:e.loading,className:"px-4 py-3 rounded-md text-sm font-medium shadow-sm w-full",style:{backgroundColor:e.loading?y.Tj.mediumGray:y.Tj.primary,color:"#fff",boxShadow:"0 0 0 1px ".concat(y.Tj.lightBorder),opacity:e.loading?.6:1,cursor:e.loading?"not-allowed":"pointer"},children:e.loading?"加载中...":"刷新"})})]})})}),(0,a.jsx)("div",{className:"flex flex-col gap-1 mt-3 text-xs text-muted-foreground",children:e.loading&&(0,a.jsxs)("div",{className:"inline-flex items-center gap-2 text-muted-foreground",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-primary"}),(0,a.jsx)("span",{className:"text-xs",children:"加载中..."})]})}),e.error&&(0,a.jsx)(f.Jr,{type:"error",message:e.error,showRefresh:!0,onRefresh:d,className:"mt-4"}),!e.loading&&0===k.length&&!e.error&&(0,a.jsx)(f.Jr,{type:"noData",message:"暂无数据",className:"mt-4"}),(0,a.jsx)("div",{className:"space-y-4 mt-3 max-h-[600px] overflow-y-auto",children:k.map((e,r)=>(0,a.jsx)(u.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*r},children:(0,a.jsx)(t.Zp,{className:"hover:shadow-md transition-shadow",children:(0,a.jsxs)(t.Wu,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[N(e.event),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold",children:e.event}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:w(e.timestamp)})]})]}),(0,a.jsx)(j.E,{className:b(e.event),variant:"outline",children:e.id})]}),e.message&&(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsx)("div",{className:"p-2 bg-muted rounded-md",children:(0,a.jsx)("pre",{className:"text-xs whitespace-pre-wrap font-mono",children:e.message})})}),e.screenshot&&(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsx)("img",{src:"/image/".concat(e.id),alt:"事件截图",className:"rounded-md object-cover w-full border",loading:"lazy"})})]})})},e.id))})]})]})]})})}}},e=>{var r=r=>e(e.s=r);e.O(0,[663,778,418,128,441,684,358],()=>r(318)),_N_E=e.O()}]);