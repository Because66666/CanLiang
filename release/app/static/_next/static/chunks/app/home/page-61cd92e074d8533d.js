(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[620],{2482:(e,t,a)=>{Promise.resolve().then(a.bind(a,4042))},4042:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>G});var l=a(854),s=a(6422),n=a(1978),r=a(9767);let o=s.forwardRef((e,t)=>{let{className:a,type:s,...n}=e;return(0,l.jsx)("input",{type:s,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...n})});o.displayName="Input";var i=a(7408),c=a(4285),d=a(4491),m=a(1692),h=a(5199),u=a(1249),x=a(5268);let p=x.bL,f=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(x.B8,{ref:t,className:(0,r.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...s})});f.displayName=x.B8.displayName;let y=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(x.l9,{ref:t,className:(0,r.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...s})});y.displayName=x.l9.displayName;let j=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(x.UC,{ref:t,className:(0,r.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...s})});j.displayName=x.UC.displayName;var g=a(8416),b=a(9472),v=a(7128);class w{formatDuration(e){let t=Math.floor(e/3600),a=Math.floor(e%3600/60);return"".concat(t,"小时").concat(a,"分钟")}calculateItemTrend(e,t,a,l){let s={},n=0,r={ItemName:[],Task:[],TimeStamp:[],Date:[]};"all"===a?r={ItemName:[...e.ItemName],Task:[...e.Task],TimeStamp:[...e.TimeStamp],Date:[...e.Date]}:e.Date.forEach((t,l)=>{t===a&&(r.ItemName.push(e.ItemName[l]),r.Task.push(e.Task[l]),r.TimeStamp.push(e.TimeStamp[l]),r.Date.push(e.Date[l]))});let o={ItemName:[],Task:[],TimeStamp:[],Date:[]};if("all"===l?o=r:r.Task.forEach((e,t)=>{e===l&&(o.ItemName.push(r.ItemName[t]),o.Task.push(r.Task[t]),o.TimeStamp.push(r.TimeStamp[t]),o.Date.push(r.Date[t]))}),o.ItemName.forEach(e=>{s[e]=(s[e]||0)+1}),"all"===l)"all"===a?n=t.Duration.reduce((e,t)=>e+t,0):t.Date.forEach((e,l)=>{e===a&&(n+=t.Duration[l])});else if(o.TimeStamp.length>0){let e={};o.TimeStamp.forEach((t,a)=>{let l=o.Date[a],[s,n,r]=t.split(":"),[i,c]=r.split("."),d=3600*parseInt(s)+60*parseInt(n)+parseInt(i);e[l]||(e[l]={min:d,max:d}),e[l].min=Math.min(e[l].min,d),e[l].max=Math.max(e[l].max,d)}),n=0,Object.values(e).forEach(e=>{let t=e.max-e.min;n+=t})}return{processedData:{item_count:s,duration:this.formatDuration(n)},filteredData:o}}calculateTrendData(e,t,a,l){let s={};if("totalItems"===e)"all"==l?t.Date.forEach((e,t)=>{s[e]?s[e]+=1:s[e]=1}):t.Date.forEach((e,a)=>{t.Task[a]===l&&(s[e]?s[e]+=1:s[e]=1)});else if("duration"===e){if("all"==l)a.Date.forEach((e,t)=>{let l=a.Duration[t];s[e]?s[e]+=l:s[e]=l});else{let e={};t.Date.forEach((a,s)=>{if(t.Task[s]===l){let[l,n,r]=t.TimeStamp[s].split(":"),[o,i]=r.split("."),c=3600*parseInt(l)+60*parseInt(n)+parseInt(o);e[a]||(e[a]={min:c,max:c}),e[a].min=Math.min(e[a].min,c),e[a].max=Math.max(e[a].max,c)}}),Object.entries(e).forEach(e=>{let[t,a]=e;s[t]=a.max-a.min})}}return s}calculateAnItemTrend(e,t,a){let l={};return"all"!==a?t.Date.forEach((s,n)=>{t.ItemName[n]===e&&t.Task[n]===a&&(l[s]=(l[s]||0)+1)}):t.Date.forEach((a,s)=>{t.ItemName[s]===e&&(l[a]=(l[a]||0)+1)}),l}saveAllData(e,t,a){let l=new Date().toISOString().slice(0,19).replace(/:/g,"-");switch(e){case"csv":this.downloadCSV(t,a,l);break;case"excel":this.downloadExcel(t,a,l);break;case"html":this.downloadHTML(t,a,l);break;case"json":this.downloadJSON(t,a,l);break;case"xml":this.downloadXML(t,a,l);break;default:console.error("不支持的文件格式:",e)}}downloadCSV(e,t,a){let l=["ItemName,Task,TimeStamp,Date",...e.ItemName.map((t,a)=>'"'.concat(t,'",').concat(e.Task[a],",").concat(e.TimeStamp[a],",").concat(e.Date[a]))].join("\n"),s=["Date,Duration",...t.Date.map((a,l)=>"".concat(a,",").concat(e.Task[l],",").concat(t.Duration[l]))].join("\n");this.downloadFile(l,"物品数据_".concat(a,".csv"),"text/csv"),this.downloadFile(s,"时长数据_".concat(a,".csv"),"text/csv")}downloadJSON(e,t,a){let l=JSON.stringify({itemData:e,durationData:t,exportTime:new Date().toISOString()},null,2);this.downloadFile(l,"数据导出_".concat(a,".json"),"application/json")}downloadHTML(e,t,a){let l='\n<!DOCTYPE html>\n<html lang="zh-CN">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>数据导出报告</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 20px; }\n        table { border-collapse: collapse; width: 100%; margin: 20px 0; }\n        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n        th { background-color: #f2f2f2; }\n        h2 { color: #333; }\n    </style>\n</head>\n<body>\n    <h1>数据导出报告</h1>\n    <p>导出时间: '.concat(new Date().toLocaleString("zh-CN"),"</p>\n    \n    <h2>物品数据</h2>\n    <table>\n        <thead>\n            <tr><th>物品名称</th><th>时间戳</th><th>日期</th></tr>\n        </thead>\n        <tbody>\n            ").concat(e.ItemName.map((t,a)=>"<tr><td>".concat(t,"</td><td>").concat(e.Task[a],"</td><td>").concat(e.TimeStamp[a],"</td><td>").concat(e.Date[a],"</td></tr>")).join(""),"\n        </tbody>\n    </table>\n    \n    <h2>时长数据</h2>\n    <table>\n        <thead>\n            <tr><th>日期</th><th>时长(秒)</th></tr>\n        </thead>\n        <tbody>\n            ").concat(t.Date.map((e,a)=>"<tr><td>".concat(e,"</td><td>").concat(t.Duration[a],"</td></tr>")).join(""),"\n        </tbody>\n    </table>\n</body>\n</html>");this.downloadFile(l,"数据报告_".concat(a,".html"),"text/html")}downloadXML(e,t,a){let l='<?xml version="1.0" encoding="UTF-8"?>\n<DataExport>\n    <ExportInfo>\n        <Timestamp>'.concat(new Date().toISOString(),"</Timestamp>\n    </ExportInfo>\n    <ItemData>\n        ").concat(e.ItemName.map((t,a)=>"<Item>\n            <Name>".concat(this.escapeXML(t),"</Name>\n            <TimeStamp>").concat(e.TimeStamp[a],"</TimeStamp>\n            <Date>").concat(e.Date[a],"</Date>\n        </Item>")).join("\n        "),"\n    </ItemData>\n    <TaskData>\n        ").concat(e.Task.map((e,t)=>"<Task>\n            <Name>".concat(this.escapeXML(e),"</Name>\n        </Task>")).join("\n        "),"\n    </TaskData>\n    <DurationData>\n        ").concat(t.Date.map((e,a)=>"<Duration>\n            <Date>".concat(e,"</Date>\n            <Seconds>").concat(t.Duration[a],"</Seconds>\n        </Duration>")).join("\n        "),"\n    </DurationData>\n</DataExport>");this.downloadFile(l,"数据导出_".concat(a,".xml"),"application/xml")}downloadExcel(e,t,a){let l=v.Wp.book_new(),s=[["物品名称","归属配置组","时间戳","日期"],...e.ItemName.map((t,a)=>[t,e.Task[a],e.TimeStamp[a],e.Date[a]])],n=[["日期","时长(秒)"],...t.Date.map((e,a)=>[e,t.Duration[a]])],r=v.Wp.aoa_to_sheet(s),o=v.Wp.aoa_to_sheet(n);v.Wp.book_append_sheet(l,r,"物品数据"),v.Wp.book_append_sheet(l,o,"时长数据");let i=new Blob([v.M9(l,{bookType:"xlsx",type:"array"})],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=URL.createObjectURL(i),d=document.createElement("a");d.href=c,d.download="数据报告_".concat(a,".xlsx"),document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(c)}downloadFile(e,t,a){let l=new Blob([e],{type:a}),s=URL.createObjectURL(l),n=document.createElement("a");n.href=s,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}escapeXML(e){return e.replace(/[<>&"']/g,e=>{switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case'"':return"&quot;";case"'":return"&apos;";default:return e}})}}let N=new w;function T(e){return(e||"").trim().replace(/^v/i,"")}async function k(e,t){let a=await fetch(e,{headers:null!=t?t:{},cache:"no-store"});if(!a.ok)throw Error("Request failed: ".concat(a.status," ").concat(a.statusText));return a.json()}async function C(){var e,t,a,l,s;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Because66666",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CanLiang",o=arguments.length>2?arguments[2]:void 0,i={Accept:"application/vnd.github+json","X-GitHub-Api-Version":"2022-11-28"};o&&(i.Authorization="Bearer ".concat(o));try{let s=await k("https://api.github.com/repos/".concat(n,"/").concat(r,"/releases/latest"),i);return{tag:(null!==(t=null!==(e=s.tag_name)&&void 0!==e?e:s.name)&&void 0!==t?t:"").toString(),publishedAt:null!==(a=s.published_at)&&void 0!==a?a:"",url:null!==(l=s.html_url)&&void 0!==l?l:"https://github.com/".concat(n,"/").concat(r,"/releases/latest")}}catch(e){try{let e=await k("https://api.github.com/repos/".concat(n,"/").concat(r,"/tags?per_page=1"),i),t=Array.isArray(e)?e[0]:void 0;return{tag:(null!==(s=null==t?void 0:t.name)&&void 0!==s?s:"").toString(),publishedAt:"",url:"https://github.com/".concat(n,"/").concat(r,"/tags")}}catch(t){throw e}}}async function D(e,t,a){let l=T("1.052"),{tag:s,url:n}=await C(e,t,a),r=T(s);return console.log("current",l,"latest",r),{current:l,latest:r,hasUpdate:function(e,t){let a=T(e).split("."),l=T(t).split("."),s=Math.max(a.length,l.length);for(let e=0;e<s;e++){var n,r,o,i;let t=parseInt(null!==(n=a[e])&&void 0!==n?n:"0",10),s=parseInt(null!==(r=l[e])&&void 0!==r?r:"0",10);if(Number.isNaN(t)||Number.isNaN(s)){let t=null!==(o=a[e])&&void 0!==o?o:"",s=null!==(i=l[e])&&void 0!==i?i:"";if(t>s)return 1;if(t<s)return -1;continue}if(t>s)return 1;if(t<s)return -1}return 0}(r,l)>0,url:n}}var S=a(7894),I=a(8498);function E(e){let{name:t,count:a,color:s,onClick:r}=e;return(0,l.jsx)(b.P.div,{whileHover:{scale:1.02},whileTap:{scale:.98},transition:{type:"spring",stiffness:300,damping:20},children:(0,l.jsx)(n.Zp,{className:"border border-gray-100 hover:shadow-md transition-shadow duration-200 cursor-pointer",onClick:r,children:(0,l.jsx)(n.Wu,{className:"p-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("div",{className:"truncate font-medium",children:t}),(0,l.jsx)("div",{className:"ml-2 rounded-full px-2 py-1 text-xs font-semibold text-white",style:{backgroundColor:s},children:a})]})})})})}function L(e){let{title:t,value:a,icon:s,color:r,onClick:o,colors:i}=e;return(0,l.jsx)("div",{children:(0,l.jsx)(b.P.div,{whileHover:{scale:1.02},whileTap:{scale:.98},transition:{type:"spring",stiffness:300,damping:20},children:(0,l.jsx)(n.Zp,{className:"border-0 shadow-sm overflow-hidden cursor-pointer hover:shadow-md transition-shadow duration-200",style:{backgroundColor:i.light},onClick:o,children:(0,l.jsxs)(n.Wu,{className:"flex items-center justify-between p-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm",style:{color:i.secondary},children:t}),(0,l.jsx)("p",{className:"text-3xl font-bold",style:{color:i.darkText},children:a})]}),(0,l.jsx)(s,{className:"h-8 w-8",style:{color:i.primary}})]})})})})}var _=a(4929),P=a(5768);function M(e){let{data:t,title:a,colors:s,type:n}=e,r=Object.entries(t).sort((e,t)=>{let[a]=e,[l]=t;return a.localeCompare(l)}),o=Math.max(...Object.values(t)),i=Math.min(...Object.values(t)),m=e=>{if("duration"===n){let t=Math.floor(e/3600),a=Math.floor(e%3600/60);return t>0?"".concat(t,"h ").concat(a,"m"):"".concat(a,"m")}return e.toString()},h=r.map((e,t)=>{let[a,l]=e;return{x:60+t/(r.length-1)*480,y:60+(o-l)/(o-i||1)*180,date:a,value:l}}),u=h.reduce((e,t,a)=>"".concat(e," ").concat(0===a?"M":"L"," ").concat(t.x," ").concat(t.y),""),x="".concat(u," L ").concat(h[h.length-1].x," ").concat(240," L ").concat(60," ").concat(240," Z"),p=(()=>{let e=[];[0,.25,.5,.75,1].forEach(t=>{let a=Math.round(i+(o-i)*(1-t));e.push(a)});let t=new Map;e.forEach(e=>{let a;if("duration"===n){let t=Math.floor(e/3600),l=Math.floor(e/60);if(o>=3600)a="".concat(t,"h");else if(l>10){let e=10*Math.floor(l/10);a="".concat(e,"m")}else a=60<=e&&e<600?"10m":"1m"}else a=e.toString();t.has(a)||t.set(a,e)});let a=[],l=Array.from(t.entries()),s=180/(l.length-1||1);return l.forEach((e,t)=>{let[l,n]=e;a.push({y:60+t*s,label:l})}),a})();return(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsxs)("div",{className:"mb-4 flex items-center gap-2",children:[(()=>{switch(n){case"totalItems":return(0,l.jsx)(c.A,{className:"h-5 w-5",style:{color:s.primary}});case"duration":return(0,l.jsx)(d.A,{className:"h-5 w-5",style:{color:s.primary}});default:return(0,l.jsx)(P.A,{className:"h-5 w-5",style:{color:s.primary}})}})(),(0,l.jsx)("span",{className:"font-medium",style:{color:s.secondary},children:"totalItems"===n?"总物品数量变化趋势":"duration"===n?"运行时间变化趋势":"数量变化趋势"})]}),(0,l.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,l.jsxs)("svg",{width:"100%",height:"300",viewBox:"0 0 ".concat(600," ").concat(300),className:"overflow-visible",children:[(0,l.jsxs)("defs",{children:[(0,l.jsx)("pattern",{id:"grid",width:"40",height:"30",patternUnits:"userSpaceOnUse",children:(0,l.jsx)("path",{d:"M 40 0 L 0 0 0 30",fill:"none",stroke:"#e5e5e5",strokeWidth:"1"})}),(0,l.jsxs)("linearGradient",{id:"areaGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:s.primary,stopOpacity:"0.3"}),(0,l.jsx)("stop",{offset:"100%",stopColor:s.primary,stopOpacity:"0.05"})]})]}),(0,l.jsx)("rect",{x:60,y:60,width:480,height:180,fill:"url(#grid)"}),p.map((e,t)=>(0,l.jsxs)("g",{children:[(0,l.jsx)("line",{x1:55,y1:e.y,x2:60,y2:e.y,stroke:"#666",strokeWidth:"1"}),(0,l.jsx)("text",{x:50,y:e.y+4,textAnchor:"end",fontSize:"12",fill:"#666",children:e.label})]},t)),(0,l.jsx)("path",{d:x,fill:"url(#areaGradient)"}),(0,l.jsx)(b.P.path,{d:u,fill:"none",stroke:s.primary,strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",initial:{pathLength:0},animate:{pathLength:1},transition:{duration:1.5,ease:"easeInOut"}}),h.map((e,t)=>(0,l.jsxs)(b.P.g,{children:[(0,l.jsx)(b.P.circle,{cx:e.x,cy:e.y,r:"4",fill:"white",stroke:s.primary,strokeWidth:"3",initial:{scale:0},animate:{scale:1},transition:{delay:.1*t+.5,duration:.3},whileHover:{scale:1.5}}),(0,l.jsxs)("text",{x:e.x,y:260,textAnchor:"middle",fontSize:"11",fill:"#666",transform:"rotate(-45, ".concat(e.x,", ").concat(260,")"),children:[e.date.slice(4)," "]}),(0,l.jsxs)(b.P.g,{opacity:0,whileHover:{opacity:1},transition:{duration:.2},children:[(0,l.jsx)("rect",{x:e.x-35,y:e.y-35,width:"70",height:"25",fill:"rgba(0,0,0,0.8)",rx:"4"}),(0,l.jsx)("text",{x:e.x,y:e.y-18,textAnchor:"middle",fontSize:"12",fill:"white",children:m(e.value)})]})]},t)),(0,l.jsx)("line",{x1:60,y1:60,x2:60,y2:240,stroke:"#333",strokeWidth:"2"}),(0,l.jsx)("line",{x1:60,y1:240,x2:540,y2:240,stroke:"#333",strokeWidth:"2"})]})}),(0,l.jsxs)("div",{className:"mt-4 grid grid-cols-3 gap-4 text-center",children:[(0,l.jsxs)("div",{className:"p-3 rounded-lg",style:{backgroundColor:s.light},children:[(0,l.jsx)("div",{className:"text-sm",style:{color:s.secondary},children:"最大值"}),(0,l.jsx)("div",{className:"text-xl font-bold",style:{color:s.darkText},children:m(o)})]}),(0,l.jsxs)("div",{className:"p-3 rounded-lg",style:{backgroundColor:s.light},children:[(0,l.jsx)("div",{className:"text-sm",style:{color:s.secondary},children:"最小值"}),(0,l.jsx)("div",{className:"text-xl font-bold",style:{color:s.darkText},children:m(i)})]}),(0,l.jsxs)("div",{className:"p-3 rounded-lg",style:{backgroundColor:s.light},children:[(0,l.jsx)("div",{className:"text-sm",style:{color:s.secondary},children:"平均值"}),(0,l.jsx)("div",{className:"text-xl font-bold",style:{color:s.darkText},children:m(Math.round(Object.values(t).reduce((e,t)=>e+t,0)/Object.values(t).length))})]})]})]})}function O(e){let{selectedItem:t,itemTrendData:a,loadingTrend:s,colors:n,onClose:r}=e;return t?(0,l.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:r,children:(0,l.jsxs)(b.P.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",stiffness:200,damping:20},className:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsxs)("h2",{className:"text-2xl font-bold",style:{color:n.secondary},children:[t," - 数量趋势"]}),(0,l.jsx)("button",{onClick:r,className:"p-2 rounded-full hover:bg-gray-100 transition-colors",children:(0,l.jsx)(_.A,{className:"h-6 w-6",style:{color:n.secondary}})})]}),s?(0,l.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,l.jsx)("div",{className:"w-8 h-8 border-4 border-t-transparent rounded-full animate-spin",style:{borderColor:n.primary,borderTopColor:"transparent"}})}):a?(0,l.jsx)(M,{data:a,title:t,colors:n,type:"item"}):(0,l.jsx)("div",{className:"text-center text-gray-500 h-64 flex items-center justify-center",children:"暂无趋势数据"})]})}):null}function A(e){let{statModal:t,colors:a,onClose:s}=e;return t?(0,l.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:s,children:(0,l.jsxs)(b.P.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",stiffness:200,damping:20},className:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold",style:{color:a.secondary},children:t.title}),(0,l.jsx)("button",{onClick:s,className:"p-2 rounded-full hover:bg-gray-100 transition-colors",children:(0,l.jsx)(_.A,{className:"h-6 w-6",style:{color:a.secondary}})})]}),t.loading?(0,l.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,l.jsx)("div",{className:"w-8 h-8 border-4 border-t-transparent rounded-full animate-spin",style:{borderColor:a.primary,borderTopColor:"transparent"}})}):t.data?(0,l.jsx)(M,{data:t.data,title:t.title,colors:a,type:t.type}):(0,l.jsx)("div",{className:"text-center text-gray-500 h-64 flex items-center justify-center",children:"暂无趋势数据"})]})}):null}var B=a(1183);let R=B.bL;B.l9;let U=B.ZL;B.bm;let W=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(B.hJ,{ref:t,className:(0,r.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});W.displayName=B.hJ.displayName;let z=s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,l.jsxs)(U,{children:[(0,l.jsx)(W,{}),(0,l.jsxs)(B.UC,{ref:t,className:(0,r.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n,children:[s,(0,l.jsxs)(B.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,l.jsx)(_.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});z.displayName=B.UC.displayName;let H=e=>{let{className:t,...a}=e;return(0,l.jsx)("div",{className:(0,r.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};H.displayName="DialogHeader";let F=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(B.hE,{ref:t,className:(0,r.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})});F.displayName=B.hE.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(B.VY,{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",a),...s})}).displayName=B.VY.displayName;var V=a(2120),J=a(1519);function X(e){let{isOpen:t,onOpenChange:a,onDownload:s,loading:n,colors:r}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(b.P.button,{className:"flex items-center justify-center w-12 h-12 rounded-full shadow-lg transition-all duration-300 hover:shadow-xl",style:{backgroundColor:r.light,border:"2px solid ".concat(r.lightBorder)},whileHover:{scale:1.1,backgroundColor:r.primary,borderColor:r.primary},whileTap:{scale:.95},onClick:()=>a(!0),children:(0,l.jsx)(b.P.div,{whileHover:{color:"#ffffff"},transition:{duration:.2},children:(0,l.jsx)(J.A,{className:"h-6 w-6",style:{color:r.secondary}})})}),(0,l.jsx)(R,{open:t,onOpenChange:a,children:(0,l.jsxs)(z,{className:"sm:max-w-md",children:[(0,l.jsx)(H,{children:(0,l.jsx)(F,{children:"选择数据导出格式"})}),(0,l.jsx)("div",{className:"grid grid-cols-2 gap-3 py-4",children:["csv","excel","json","html","xml"].map(e=>(0,l.jsx)(V.$,{variant:"outline",onClick:()=>s(e),disabled:n,className:"h-12 text-sm transition-all duration-200 hover:scale-105",style:{borderColor:r.lightBorder,color:r.secondary},children:n?(0,l.jsx)("div",{className:"w-4 h-4 border-2 border-t-transparent rounded-full animate-spin"}):e.toUpperCase()},e))})]})})]})}var Z=a(4402);function G(){let[e,t]=(0,s.useState)([]),[a,r]=(0,s.useState)([]),[x,v]=(0,s.useState)(),[w,T]=(0,s.useState)(),[k,C]=(0,s.useState)(""),[_,P]=(0,s.useState)(""),[M,B]=(0,s.useState)(null),[R,U]=(0,s.useState)(!0),[W,z]=(0,s.useState)(null),[H,F]=(0,s.useState)(""),[V,J]=(0,s.useState)(!1),[G,q]=(0,s.useState)(0),[Y,K]=(0,s.useState)(null),[$,Q]=(0,s.useState)(null),[ee,et]=(0,s.useState)(null),[ea,el]=(0,s.useState)(!1),[es,en]=(0,s.useState)(null),[er,eo]=(0,s.useState)(!1),[ei,ec]=(0,s.useState)(!1),[ed,em]=(0,s.useState)(!1),eh=async e=>{let t={totalItems:"物品数量趋势",duration:"运行时间趋势"};"all"!==_?en({type:e,title:"【".concat(_,"】").concat(t[e]),data:null,loading:!0}):en({type:e,title:"总".concat(t[e]),data:null,loading:!0});try{let t=N.calculateTrendData(e,x,w,_);en(e=>e?{...e,data:t,loading:!1}:null)}catch(a){console.error("获取".concat(t[e],"数据失败:"),a),en(e=>e?{...e,data:{},loading:!1}:null)}},eu=async e=>{Q(e),el(!0),et(null);try{let t=N.calculateAnItemTrend(e,x,_);et(t)}catch(e){console.error("获取物品趋势数据失败:",e),et({})}finally{el(!1)}},ex=async e=>{ec(!0);try{await N.saveAllData(e,x,w),eo(!1)}catch(e){console.error("下载失败:",e),alert("下载失败，请稍后再试")}finally{ec(!1)}};if((0,s.useEffect)(()=>{(async()=>{try{U(!0);let e=await S.K.fetchDateList();e.sort((e,t)=>t.value.localeCompare(e.value)),t(e);let{itemData:a,durationData:l}=await S.K.fetchAllData();if(v(a),T(l),e.length>0){C(e[0].value),P("all");let{processedData:t,filteredData:s}=N.calculateItemTrend(a,l,e[0].value,"all"),n=[...new Set(s.Task)];n.unshift("all"),r(n)}z(null)}catch(e){console.error("获取日期列表失败:",e),z("获取日期列表失败，请稍后再试")}finally{U(!1)}})()},[]),(0,s.useEffect)(()=>{let e=!0;return(async()=>{try{let{hasUpdate:t}=await D("Because66666","CanLiang");console.log("hasUpdate",t),e&&em(t)}catch(e){}})(),()=>{e=!1}},[]),(0,s.useEffect)(()=>{(async()=>{if(k&&x&&w)try{U(!0);let{processedData:e,filteredData:t}=N.calculateItemTrend(x,w,k,_);if(e.item_count&&0!==Object.keys(e.item_count).length)B(e);else{console.log("警告：processedData的item_count记录为空");let{processedData:e,filteredData:t}=N.calculateItemTrend(x,w,k,"all");P("all"),B(e)}if("all"!=k){let{processedData:e,filteredData:t}=N.calculateItemTrend(x,w,k,"all"),a=[...new Set(t.Task)];a.unshift("all"),r(a)}else{let e=[...new Set(x.Task)].filter(e=>""!==e);e.unshift("all"),r(e)}z(null)}catch(e){console.error("处理数据失败:",e),z("处理数据失败，请稍后再试")}finally{U(!1)}})()},[k,_,x,w]),R)return(0,l.jsx)("div",{className:"flex h-screen items-center justify-center bg-white",children:(0,l.jsxs)(b.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5},className:"text-xl flex flex-col items-center",children:[(0,l.jsx)(b.P.div,{className:"w-16 h-16 border-4 border-t-transparent rounded-full mb-6",style:{borderColor:"".concat(I.Tj.lightBorder," transparent ").concat(I.Tj.lightBorder," ").concat(I.Tj.lightBorder)},animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}}),(0,l.jsx)(b.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5},style:{color:I.Tj.secondary},className:"font-medium",children:"正在加载和分析数据..."}),(0,l.jsx)(b.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5,duration:.5},style:{color:I.Tj.primary},className:"text-sm mt-2",children:"请稍候片刻"})]})});if(W)return(0,l.jsx)(Z.M,{type:"error",message:W,showRefresh:!0,onRefresh:()=>window.location.reload(),colors:I.Tj});if(!M)return(0,l.jsx)(Z.M,{type:"noData",message:"当前没有可显示的数据",colors:I.Tj});let ep=(0,I.ID)(M.item_count),ef=(0,I.NL)(M.item_count);(0,I.ge)(M.item_count);let ey=M.duration,ej=(0,I.Em)(M.item_count),eg=(0,I.wd)(ep),eb=(0,I.kz)(eg),ev=e=>{K(e)},ew=ej.length>0?ej[0][1]:0;return(0,l.jsxs)("div",{className:"container mx-auto px-4 py-8 bg-white relative",children:[(0,l.jsx)(b.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.3},className:"fixed top-6 right-6 z-50",children:(0,l.jsxs)(b.P.a,{href:"https://github.com/Because66666/CanLiang",target:"_blank",rel:"noopener noreferrer",className:"relative flex items-center justify-center w-12 h-12 rounded-full shadow-lg transition-all duration-300 hover:shadow-xl",style:{backgroundColor:I.Tj.light,border:"2px solid ".concat(I.Tj.lightBorder)},whileHover:{scale:1.1,backgroundColor:I.Tj.primary,borderColor:I.Tj.primary},whileTap:{scale:.95},children:[(0,l.jsx)(b.P.div,{whileHover:{color:"#ffffff"},transition:{duration:.2},children:(0,l.jsx)(i.A,{className:"h-6 w-6",style:{color:I.Tj.secondary}})}),ed&&(0,l.jsx)("span",{className:"absolute -top-1 -right-1 bg-transparent text-red-500 text-[10px] px-1 rounded-full",children:"new"})]})}),(0,l.jsx)(b.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.3},className:"fixed top-20 right-6 z-50",children:(0,l.jsx)(X,{isOpen:er,onOpenChange:eo,onDownload:ex,loading:ei,colors:I.Tj})}),(0,l.jsx)(O,{selectedItem:$,itemTrendData:ee,loadingTrend:ea,colors:I.Tj,onClose:()=>{Q(null),et(null)}}),(0,l.jsx)(A,{statModal:es,colors:I.Tj,onClose:()=>{en(null)}}),(0,l.jsxs)("div",{className:"mb-8 text-3xl font-bold text-center flex items-center justify-center gap-3",style:{color:I.Tj.secondary},children:[(0,l.jsx)("img",{src:"/canliang.png",alt:"参量质变仪图标",className:"w-10 h-10 object-cover rounded-lg"}),"参量质变仪"]}),(0,l.jsxs)("div",{className:"mb-8 grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,l.jsx)(L,{title:"物品数量",value:ef.toString(),icon:c.A,color:I.Tj.primary,colors:I.Tj,onClick:()=>eh("totalItems")}),(0,l.jsx)(L,{title:"运行时间",value:ey,icon:d.A,color:I.Tj.primary,colors:I.Tj,onClick:()=>eh("duration")}),(0,l.jsx)(L,{title:"最多物品",value:(()=>{let e=Object.entries(M.item_count).sort((e,t)=>t[1]-e[1]);return e.length>0?e[0][0]:"暂无数据"})(),icon:m.A,color:I.Tj.primary,colors:I.Tj})]}),(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row gap-8",children:[(0,l.jsxs)("div",{className:"w-full lg:w-1/3 space-y-8",children:[(0,l.jsx)(b.P.div,{children:(0,l.jsx)(n.Zp,{className:"border-0 shadow-sm overflow-hidden",children:(0,l.jsxs)(n.Wu,{className:"p-6",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4",style:{color:I.Tj.secondary},children:"物品类别分布"}),(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)(b.P.div,{className:"relative w-[200px] h-[200px]",initial:{rotate:-90},animate:{rotate:0},transition:{duration:.8,type:"spring"},children:(0,l.jsx)("svg",{viewBox:"0 0 200 200",className:"w-full h-full",children:eb.map((e,t)=>(0,l.jsx)(b.P.path,{d:e.path,fill:e.color,stroke:"white",strokeWidth:"1",animate:{opacity:1},transition:{delay:.1*t,duration:.5},onMouseEnter:()=>ev(t),onMouseLeave:()=>ev(null),whileHover:{scale:1.15,transformOrigin:"center",transition:{type:"spring",stiffness:300}}},t))})}),(0,l.jsx)("div",{className:"mt-6 grid grid-cols-2 gap-x-4 gap-y-3 w-full",children:eb.map((e,t)=>(0,l.jsxs)(b.P.div,{className:"flex items-center",style:{backgroundColor:Y===t?"#f0f4ff":"transparent",borderRadius:6,padding:"4px 8px"},onMouseEnter:()=>ev(t),onMouseLeave:()=>ev(null),transition:{duration:.2},children:[(0,l.jsx)("div",{className:"w-4 h-4 mr-2 flex-shrink-0 rounded-sm",style:{backgroundColor:e.color}}),(0,l.jsxs)("div",{className:"flex justify-between w-full",children:[(0,l.jsx)(b.P.span,{className:"text-sm font-medium",animate:{fontWeight:Y===t?700:500,scale:Y===t?1.05:1,color:Y===t?I.Tj.primary:I.Tj.secondary},transition:{duration:.2},children:e.name}),(0,l.jsxs)(b.P.span,{className:"text-sm",animate:{scale:Y===t?1.1:1,color:Y===t?I.Tj.primary:I.Tj.secondary},transition:{duration:.2},children:[e.percentage,"%"]})]})]},t))})]})]})})},"pie-chart-".concat(G)),(0,l.jsx)(b.P.div,{children:(0,l.jsx)(n.Zp,{className:"border-0 shadow-sm overflow-hidden",children:(0,l.jsxs)(n.Wu,{className:"p-6",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4",style:{color:I.Tj.secondary},children:"物品数量排行（前十五）"}),(0,l.jsx)("div",{className:"space-y-4",children:ej.slice(0,15).map((e,t)=>{let[a,s]=e;return(0,l.jsxs)(b.P.div,{className:"flex flex-col cursor-pointer",animate:{x:0},transition:{delay:.1*t,duration:.3},onClick:()=>eu(a),whileHover:{scale:1.02},whileTap:{scale:.98},children:[(0,l.jsxs)("div",{className:"flex justify-between text-sm mb-1",children:[(0,l.jsx)("span",{className:"font-medium truncate",children:a}),(0,l.jsx)("span",{style:{color:I.Tj.secondary},children:s})]}),(0,l.jsx)("div",{className:"w-full bg-gray-100 rounded-full h-3",children:(0,l.jsx)(b.P.div,{initial:{width:0},animate:{width:"".concat(s/ew*100,"%")},transition:{duration:.8,delay:.2+.1*t},className:"h-3 rounded-full",style:{backgroundColor:I.JI[t%I.JI.length]}})})]},t)})})]})})},"bar-chart-".concat(G))]}),(0,l.jsxs)("div",{className:"w-full lg:w-2/3",children:[(0,l.jsx)(b.P.div,{className:"mb-8 p-6 rounded-lg",style:{backgroundColor:I.Tj.light},children:(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 items-center justify-items-center",children:[(0,l.jsxs)("div",{className:"flex flex-col items-center gap-2 w-full max-w-[200px]",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(h.A,{className:"h-4 w-4",style:{color:I.Tj.primary}}),(0,l.jsx)("span",{className:"text-sm",style:{color:I.Tj.secondary},children:"搜索物品:"})]}),(0,l.jsx)("div",{className:"relative w-full",children:(0,l.jsx)(o,{placeholder:"搜索物品...",className:"pl-4 py-3 border-0 shadow-sm focus:ring-2 w-full",style:{borderColor:I.Tj.lightBorder,boxShadow:"0 0 0 1px ".concat(I.Tj.lightBorder)},value:H,onChange:e=>F(e.target.value)})})]}),(0,l.jsxs)("div",{className:"flex flex-col items-center gap-2 w-full max-w-[200px]",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(u.A,{className:"h-4 w-4",style:{color:I.Tj.primary}}),(0,l.jsx)("span",{className:"text-sm",style:{color:I.Tj.secondary},children:"选择日期:"})]}),(0,l.jsxs)(g.l6,{value:k,onValueChange:e=>{e!==k&&(C(e),q(e=>e+1))},children:[(0,l.jsx)(g.bq,{className:"w-full border-0 shadow-sm focus:ring-2",style:{borderColor:I.Tj.lightBorder,boxShadow:"0 0 0 1px ".concat(I.Tj.lightBorder)},children:(0,l.jsx)(g.yv,{placeholder:"选择日期"})}),(0,l.jsx)(g.gC,{children:e.filter(e=>"string"==typeof(null==e?void 0:e.value)&&""!==e.value.trim()).map(e=>(0,l.jsx)(g.eb,{value:e.value,children:e.label},e.value))})]})]}),(0,l.jsxs)("div",{className:"flex flex-col items-center gap-2 w-full max-w-[200px]",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(u.A,{className:"h-4 w-4",style:{color:I.Tj.primary}}),(0,l.jsx)("span",{className:"text-sm",style:{color:I.Tj.secondary},children:"选择配置组:"})]}),(0,l.jsxs)(g.l6,{value:_,onValueChange:e=>{e!==_&&(P(e),q(e=>e+1))},children:[(0,l.jsx)(g.bq,{className:"w-full border-0 shadow-sm focus:ring-2",style:{borderColor:I.Tj.lightBorder,boxShadow:"0 0 0 1px ".concat(I.Tj.lightBorder)},children:(0,l.jsx)(g.yv,{placeholder:"all"})}),(0,l.jsx)(g.gC,{children:a.filter(e=>"string"==typeof e&&""!==e.trim()).map(e=>(0,l.jsx)(g.eb,{value:e,children:e},e))})]})]}),(0,l.jsxs)("div",{className:"flex flex-col items-center gap-2 w-full max-w-[200px]",children:[(0,l.jsx)("div",{className:"h-6"})," ",(0,l.jsx)("button",{onClick:()=>{C("all"),P("all"),q(e=>e+1)},className:"px-4 py-3 rounded-md text-sm font-medium shadow-sm w-full",style:{backgroundColor:"all"===k?I.Tj.primary:"#fff",color:"all"===k?"#fff":I.Tj.secondary,boxShadow:"0 0 0 1px ".concat(I.Tj.lightBorder)},children:"全部"})]})]})}),(0,l.jsxs)(p,{defaultValue:"all",className:"flex flex-col items-center",children:[(0,l.jsx)(b.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4},children:(0,l.jsxs)(f,{className:"mb-6 p-1 rounded-md",style:{backgroundColor:I.Tj.lightGray},children:[(0,l.jsx)(y,{value:"all",className:"data-[state=active]:text-white",style:{backgroundColor:"transparent",color:I.Tj.secondary,"--tw-data-state-active-bg":I.Tj.primary},children:"全部"}),Object.keys(ep).map(e=>(0,l.jsx)(y,{value:e,className:"data-[state=active]:text-white",style:{backgroundColor:"transparent",color:I.Tj.secondary,"--tw-data-state-active-bg":I.Tj.primary},children:e},e))]})}),(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)(j,{value:"all",children:(0,l.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3",children:(0,I.IL)(M.item_count,H).map((e,t)=>{let[a,s]=e;return(0,l.jsx)(E,{name:a,count:s,color:(0,I.bU)(a),onClick:()=>eu(a)},a)})},"all-items-".concat(G))}),Object.entries(ep).map(e=>{let[t,a]=e;return(0,l.jsx)(j,{value:t,children:(0,l.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3",children:(0,I.IL)(a,H).map((e,a)=>{let[s,n]=e;return(0,l.jsx)(E,{name:s,count:n,color:I.NS[t],onClick:()=>eu(s)},s)})},"".concat(t,"-items-").concat(G))},t)})]})]})]})]})]})}},7615:()=>{},9972:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[430,472,730,568,655,511,230,569,358],()=>t(2482)),_N_E=e.O()}]);